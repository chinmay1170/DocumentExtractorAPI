================================================================================
TEST CASES FOR VALIDATION
Idempotent Extraction API Assessment
================================================================================

================================================================================
TEST CASE 1: Multi-line Invoice with Extra Whitespace
================================================================================

INPUT (POST /extract):
{
  "idempotency_key": "test-multiline-001",
  "document_text": "INVOICE\n\nInvoice Number: ACME-2024-5678\nDate: December 15, 2024\n\nBill To:\nAcme Corporation\n123 Business St\n\nItems:\n- Consulting Services    $1,200.00\n- Software License       $800.00\n\nSubtotal: $2,000.00\nTax: $180.00\nTOTAL: $2,180.00 USD\n\nPayment due within 30 days"
}

EXPECTED RESPONSE (POST /extract):
{
  "request_id": "req_abc123",
  "status": "COMPLETED"
}

EXPECTED RESPONSE (GET /extract/req_abc123):
{
  "request_id": "req_abc123",
  "status": "COMPLETED",
  "result": {
    "doc_type": "invoice",
    "invoice_number": "ACME-2024-5678",
    "invoice_date": "2024-12-15",
    "total_amount": 2180.0,
    "currency": "USD"
  },
  "error": null
}

================================================================================
TEST CASE 2: Ambiguous Document (Receipt vs Invoice)
================================================================================

INPUT (POST /extract):
{
  "idempotency_key": "test-ambiguous-002",
  "document_text": "RECEIPT\n==================\nStore: Tech Mart\nDate: 2024-11-28\nTransaction #: 789456\n\nPurchased Items:\n1x Laptop - $899.99\n2x USB Cable - $15.00\n\nSubtotal: $914.99\nTax (8%): $73.20\n------------------\nTotal Paid: $988.19\n\nPayment Method: Credit Card\nThank you for your purchase!"
}

EXPECTED RESPONSE (POST /extract):
{
  "request_id": "req_def456",
  "status": "COMPLETED"
}

EXPECTED RESPONSE (GET /extract/req_def456):
{
  "request_id": "req_def456",
  "status": "COMPLETED",
  "result": {
    "doc_type": "receipt",
    "invoice_number": "789456",
    "invoice_date": "2024-11-28",
    "total_amount": 988.19,
    "currency": null
  },
  "error": null
}

NOTE: Currency is implicit (likely USD) but not explicitly stated in the 
document.

================================================================================
TEST CASE 3: Malformed/Incomplete Document
================================================================================

INPUT (POST /extract):
{
  "idempotency_key": "test-incomplete-003",
  "document_text": "Hey, here's the invoice we discussed.\n\nInvoice for project work\nAmount: five hundred dollars\nLet me know if you need anything else!\n\nThanks,\nJohn"
}

EXPECTED RESPONSE (POST /extract):
{
  "request_id": "req_ghi789",
  "status": "COMPLETED"
}

EXPECTED RESPONSE (GET /extract/req_ghi789):
{
  "request_id": "req_ghi789",
  "status": "COMPLETED",
  "result": {
    "doc_type": "invoice",
    "invoice_number": null,
    "invoice_date": null,
    "total_amount": null,
    "currency": null
  },
  "error": null
}

NOTE: Extractor should handle missing or unstructured data gracefully.

================================================================================
TEST CASE 4: Document with Special Characters and Formatting
================================================================================

INPUT (POST /extract):
{
  "idempotency_key": "test-special-chars-004",
  "document_text": "╔═══════════════════════════════╗\n║     INVOICE - PAID            ║\n╚═══════════════════════════════╝\n\nInvoice #: INV/2024/Q4/1001\nIssued: 2024-12-01\n\nClient: Müller & Sons GmbH\n\nDescription          Amount\n─────────────────────────────\nWeb Development     €3,500.00\nHosting (Annual)      €450.00\n─────────────────────────────\nGrand Total:        €3,950.00\n\n** Payment received via bank transfer **"
}

EXPECTED RESPONSE (POST /extract):
{
  "request_id": "req_jkl012",
  "status": "COMPLETED"
}

EXPECTED RESPONSE (GET /extract/req_jkl012):
{
  "request_id": "req_jkl012",
  "status": "COMPLETED",
  "result": {
    "doc_type": "invoice",
    "invoice_number": "INV/2024/Q4/1001",
    "invoice_date": "2024-12-01",
    "total_amount": 3950.0,
    "currency": "EUR"
  },
  "error": null
}

================================================================================
TEST CASE 5: Idempotency with Extractor Failure (CRITICAL TEST)
================================================================================

FIRST REQUEST (POST /extract) - Simulate extractor timeout/failure:
{
  "idempotency_key": "test-failure-005",
  "document_text": "<<TRIGGER_EXTRACTOR_FAILURE>>\nInvoice data that will cause processing to fail"
}

FIRST RESPONSE (POST /extract):
{
  "request_id": "req_mno345",
  "status": "FAILED"
}

FIRST GET RESPONSE (GET /extract/req_mno345):
{
  "request_id": "req_mno345",
  "status": "FAILED",
  "result": null,
  "error": {
    "code": "EXTRACTOR_TIMEOUT",
    "message": "Extraction process timed out after 30 seconds"
  }
}

RETRY REQUEST (Same idempotency_key, POST /extract):
{
  "idempotency_key": "test-failure-005",
  "document_text": "<<TRIGGER_EXTRACTOR_FAILURE>>\nInvoice data that will cause processing to fail"
}

RETRY RESPONSE (MUST return same request_id):
{
  "request_id": "req_mno345",
  "status": "FAILED"
}

CRITICAL VALIDATION: The retry MUST return the same request_id even though 
the first attempt failed. This validates proper idempotency handling under 
failure conditions.

================================================================================
TEST CASE 6: Document with No Invoice/Receipt Markers
================================================================================

INPUT (POST /extract):
{
  "idempotency_key": "test-unknown-006",
  "document_text": "Meeting notes from Q4 planning session\n\nAttendees: Alice, Bob, Charlie\nDate: 2024-12-10\n\nAction items:\n- Review budget for next quarter\n- Schedule follow-up meeting\n- Update project timeline\n\nTotal estimated hours: 120"
}

EXPECTED RESPONSE (POST /extract):
{
  "request_id": "req_pqr678",
  "status": "COMPLETED"
}

EXPECTED RESPONSE (GET /extract/req_pqr678):
{
  "request_id": "req_pqr678",
  "status": "COMPLETED",
  "result": {
    "doc_type": "unknown",
    "invoice_number": null,
    "invoice_date": null,
    "total_amount": null,
    "currency": null
  },
  "error": null
}

================================================================================
USAGE NOTES
================================================================================

- Test Case 5 is the CRITICAL failure/retry scenario from the specification
- Candidates should handle multi-line strings, special characters, and 
  ambiguous data
- The <<TRIGGER_EXTRACTOR_FAILURE>> marker is a suggestion for mock 
  extractors to simulate failures
- These cases test extraction logic, null handling, and edge case robustness
- request_id values (req_abc123, etc.) are examples - actual IDs will vary
- Candidates may handle some edge cases differently; focus on consistency 
  and documentation of their approach

================================================================================
END OF TEST CASES
================================================================================